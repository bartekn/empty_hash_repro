#!/usr/bin/env bash
set -e

source /etc/profile
# work within the current docker working dir
if [ ! -f "./stellar-core.cfg" ]; then
   cp /stellar-core.cfg ./
fi

# wait for the first checkpoint
until curl -s -f -o /dev/null "http://core:1570/.well-known/stellar-history.json"
do
  echo "waiting for checkpoint..."
  sleep 5
done

exec stellar-core run --metadata-output-stream=/stream --in-memory --console &

sleep 10

curl "http://localhost:11626/tx?blob=AAAAAgAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAGQAAAAAAAAAZAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAAAAAAAABfXhAAAAAAAAAAABEblG1gAAAEDtzvcUOQJtKrP96lzE%2FjYZ%2FpvA7b9IJSCrmasHcnAxyfpVmSHPzompH4weBN9%2FgHcxPELfak8QqSsZwnBhI6YN"

sleep 5

curl "http://localhost:11626/tx?blob=AAAAAgAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAGQAAAAAAAAAZAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAAAAAAAABfXhAAAAAAAAAAABEblG1gAAAECac%2FejYm21yb1vG6D%2Fo1tt0QxMLtUboA8WAZ9WEhXtbMCOyUeTIyP%2BIlH%2BJZixBlIELLapQoFvSKTBzUzjeMcH"

sleep 5

curl "http://localhost:11626/tx?blob=AAAAAgAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAGQAAAAAAAAAbAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAGQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAAAAAAAABfXhAAAAAAAAAAABEblG1gAAAECDKQJAhyDk9IMGjqMTNKdCP2YfCD8aJuFV5Y9jgfKdyOBG1aSqj8GEkXVvoj3HZJQ2I9QRlIoFUim9vQAIV4cP"
curl "http://localhost:11626/tx?blob=AAAAAgAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAGQAAAAAAAAAbQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAAAAAAAABfXhAAAAAAAAAAABEblG1gAAAEAD%2F706QMRihJOhCprdTiiPyR364etgSv315ikY4QLC2OJ8TX%2BKCxreqyy3s1N0FWMsO0lc6a9W1h%2FIxk%2FeNmkM"
curl "http://localhost:11626/tx?blob=AAAAAgAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAGQAAAAAAAAAbgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAABzdv3ojkzWHMD7KUoXhrPx0GH18vHKV0ZfqpMiEblG1gAAAAAAAAAABfXhAAAAAAAAAAABEblG1gAAAECz5AlF8s%2FcvQZGn889ehD3OycE01eFpHxufoU1bcqfMtWCAkLG66cpDOJBFj%2FN%2FHDhVoYbIeLs7Xpp7M8o2xcO"

sleep infinity